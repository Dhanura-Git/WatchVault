<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WatchVault forgot password</title>

    <style>
        .input-wrapper {
            margin-bottom: 1em;
        }

        .error {
            color: red;
            font-size: 0.8em;
        }

        .form-body {
            display: flex;
            /* Use flexbox for alignment */
            flex-direction: column;
            /* Arrange items in a column */
            align-items: center;
            /* Center items horizontally */
            justify-content: center;
            /* Center items vertically */
            padding: 20px;
            /* Add some padding */
        }

        .default-form-box {
            width: 100%;
            /* Make form box take full width */
            max-width: 400px;
            /* Set a max width for the form box */
            margin: 10px 0;
            /* Add margin for spacing between inputs */
        }

        .password-container {
            display: flex;
            /* Use flexbox for input and eye icon */
            align-items: center;
            /* Align items vertically centered */
        }

        .eye-icon {
            cursor: pointer;
            /* Change cursor to pointer on hover */
            margin-left: 10px;
            /* Space between input and icon */
        }

        .error {
            color: red;
            /* Color for error messages */
            font-size: 12px;
            /* Font size for error messages */
            margin-top: 5px;
            /* Space above error messages */
        }
    </style>

</head>

<body>

    <div class="container">
        <div class="image-wapper"
            style="background-image: url(https://cdn4.ethoswatches.com/the-watch-guide/wp-content/uploads/2022/11/Jaeger-LeCoultre-Polaris-Perpetual-Calendar-Masthead-Desktop@1.6x-1-1536x597.jpg)">
            <h1>WatchVault</h1>
        </div>
        <div class="form-wapper">
            <div class="form-header">
            </div>
            <div class="form-body">
                <h2>Change password</h2>

                <form id="changePasswordForm" novalidate>
                    <div class="default-form-box">
                        <label>Current Password</label>
                        <div class="password-container">
                            <input type="password" id="Current-password" name="Current-password" required>
                            <span class="eye-icon" onclick="togglePasswordVisibility('Current-password')">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                        <div id="currentPasswordError" class="error"></div>
                    </div>
                    <br>
                    <div class="default-form-box">
                        <label>New Password</label>
                        <div class="password-container">
                            <input type="password" id="new-password" name="new-password" required>
                            <span class="eye-icon" onclick="togglePasswordVisibility('new-password')">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                        <div id="newPasswordError" class="error"></div>
                    </div>
                    <br>
                    <div class="default-form-box">
                        <label>Confirm Password</label>
                        <div class="password-container">
                            <input type="password" id="confirm-password" name="confirm-password" required>
                            <span class="eye-icon" onclick="togglePasswordVisibility('confirm-password')">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                        <br>
                        <div id="confirmPasswordError" class="error"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Change Password</button>
                    <br>
                    <br>
                    <a href="/"> Back to Home </a>
                </form>
            </div>

        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#changePasswordForm').on('submit', function (event) {
                event.preventDefault();


                const isValid = validatePasswordForm();
                if (!isValid) return;

                const formData = $(this).serialize();

                $.ajax({
                    url: '/changepassword',
                    type: 'POST',
                    data: formData,
                    dataType: 'json',
                    success: function (result) {
                        if (result.success) {

                            Swal.fire({
                                title: 'Success',
                                text: result.message,
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then(() => {
                                window.location.href = '/home';
                            });
                        } else {

                            Swal.fire({
                                title: 'Error',
                                text: result.message,
                                icon: 'error',
                                confirmButtonText: 'OK'
                            });
                        }
                    },
                    error: function () {
                        Swal.fire({
                            title: 'Error',
                            text: 'incorrect password',
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                    }
                });
            });

            function validatePasswordForm() {
                const currentPassword = $('input[name="Current-password"]').val().trim();
                const newPassword = $('input[name="new-password"]').val().trim();
                const confirmPassword = $('input[name="confirm-password"]').val().trim();

                const currentPasswordError = $('#currentPasswordError');
                const newPasswordError = $('#newPasswordError');
                const confirmPasswordError = $('#confirmPasswordError');

                currentPasswordError.text('');
                newPasswordError.text('');
                confirmPasswordError.text('');

                let isValid = true;

                if (currentPassword === '') {
                    currentPasswordError.text('Current Password field is required');
                    isValid = false;
                }

                if (newPassword === '') {
                    newPasswordError.text('New Password field is required');
                    isValid = false;
                } else if (newPassword.length < 6) {
                    newPasswordError.text('New Password must be at least 6 characters long');
                    isValid = false;
                } else if (/^(\w)\1*$/.test(newPassword)) {
                    newPasswordError.text('New Password cannot be made up of the same character repeated');
                    isValid = false;
                }

                if (confirmPassword === '') {
                    confirmPasswordError.text('Confirm Password field is required');
                    isValid = false;
                } else if (newPassword !== confirmPassword) {
                    confirmPasswordError.text('Passwords do not match');
                    isValid = false;
                }

                return isValid;
            }


            function togglePasswordVisibility(fieldName) {
                const passwordField = $(`input[name="${fieldName}"]`);
                const eyeIcon = passwordField.next('.eye-icon').find('i');
                if (passwordField.attr('type') === 'password') {
                    passwordField.attr('type', 'text');
                    eyeIcon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    passwordField.attr('type', 'password');
                    eyeIcon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            }
        });
    </script>

</body>


</html>

<style>
    html {
        --main-color: #04957d;
        --main-color-hover: #06af93;
        --body-background: #f5f5f5;
        --text-color: #333;
        --box-bg-color: #fff;
        --box-shadow-color: #e4e4e4;
        --menu-active-bg: #f3f3ff;
        --menu-active-border-color: var(--main-color);
        --menu-badge-bg: #ff9f43;
        --line-color: var(--body-background);
        --scroll-bar-bg: var(--box-bg-color);
        --scroll-bar-color: #ccc;
        --success-color: #28c76f;
        --danger-color: #ea5455;
        --warning-color: #ff9f43;
        --border-color: #ced4da;
        --disable-text-color: #707070;
    }

    html.dark {
        --main-color: #675ad0;
        --main-color-hover: #877be6;
        --body-background: #121212;
        --box-bg-color: #1d1d1d;
        --text-color: #e1e1e1;
        --box-shadow-color: #0a0a0a;
        --menu-active-bg: #3c3c3c;
        --scroll-bar-bg: var(--box-bg-color);
        --scroll-bar-color: #000;
        --border-color: #707070;
    }

    .center-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        /* This centers the children horizontally */
        justify-content: center;
        /* This centers the children vertically */
    }

    .icon-svg {
        display: inline-block;
        vertical-align: middle;
        /* Adjusts the SVG to align with the text */
    }


    ::selection {
        color: #fff;
        background-color: var(--main-color);
    }

    ::-moz-selection {
        color: #fff;
        background-color: var(--main-color);
    }

    * {
        outline: none;
        box-sizing: border-box;
    }

    html {
        overflow-x: hidden;
        scrollbar-color: var(--scroll-bar-color) var(--scroll-bar-bg);
        scrollbar-width: thin;
        font-size: 14px;
    }

    html::-webkit-scrollbar-track {
        background-color: var(--scroll-bar-bg);
        border-radius: 10px;
    }

    html::-webkit-scrollbar {
        width: 10px;
        height: 10px;
        background-color: var(--scroll-bar-bg);
    }

    html::-webkit-scrollbar-thumb {
        border-radius: 10px;
        background-color: var(--scroll-bar-color);
        border: 2px solid var(--scroll-bar-bg);
    }

    @media (min-width: 576px) {
        html {
            font-size: 16px;
        }
    }

    @media (min-width: 992px) {
        html {
            font-size: 16px;
        }
    }

    body {
        margin: 0;
        font-family: "Montserrat", sans-serif;
        padding: 15px;
        background-color: var(--body-background);
        color: var(--text-color);
        height: 100vh;
        /* Use the full height of the viewport */
        display: flex;
        justify-content: center;
        align-items: center;
    }

    @media (min-width: 576px) {
        body {
            padding: 20px;
        }
    }

    @media (min-width: 992px) {
        body {
            padding: 30px;
        }
    }

    a {
        text-decoration: none;
        color: var(--main-color);
    }

    a:hover {
        color: var(--main-color-hover);
    }

    .container {
        width: 100%;
        max-width: 800px;
        height: 90vh;
        /* Set the height to 90% of the viewport height */
        display: flex;
        background-color: var(--box-bg-color);
        border-radius: 15px;
        box-shadow: 3px 3px 6px 0px var(--box-shadow-color);
        overflow: hidden;
        flex-direction: column;
    }

    @media (min-width: 576px) {
        .container {
            flex-direction: row;
        }
    }

    .container .image-wapper,
    .container .form-wapper {
        flex: 0 1 100%;
        max-width: 100%;
        padding: 30px;
    }

    @media (min-width: 576px) {

        .container .image-wapper,
        .container .form-wapper {
            flex: 0 1 50%;
            max-width: 50%;
        }
    }

    .container .image-wapper {
        display: flex;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        position: relative;
    }

    .container .image-wapper::before {
        content: "";
        display: block;
        position: absolute;
        inset: 0;
        background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.7));
    }

    .container .image-wapper h1 {
        align-self: flex-end;
        font-size: 40px;
        color: #fff;
        z-index: 1;
        margin: 0;
    }

    .container .form-wapper .form-header,
    .container .form-wapper .form-body {
        margin-bottom: 20px;
    }

    .container .form-wapper .form-header h2 {
        font-size: 24px;
        margin: 0;
    }

    .container .form-wapper .form-header p {
        font-size: 14px;
        color: #bbb;
        margin: 20px 0 0;
    }

    .container .form-wapper .form-body .input-wrapper {
        margin-bottom: 15px;
        position: relative;
    }

    .container .form-wapper .form-body .input-wrapper>label {
        display: block;
        margin-bottom: 5px;
        font-size: 14px;
    }

    .container .form-wapper .form-body .input-wrapper>input {
        display: block;
        width: 100%;
        height: 39px;
        padding: 0 10px;
        border-radius: 5px;
        border: 1px solid #707070;
        color: var(--text-color);
        background-color: transparent;
    }

    .container .form-wapper .form-body .input-wrapper .icon {
        position: absolute;
        bottom: 10px;
        right: 10px;
        font-size: 18px;
        line-height: 0.8;
        color: #6b6b6b;
        z-index: 2;
        cursor: pointer;
    }

    .container .form-wapper .form-body .input-wrapper.more-action {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
    }

    .container .form-wapper .form-body .input-wrapper.more-action label {
        margin: 0;
        font-size: 12px;
    }

    .container .form-wapper .form-body .input-wrapper.more-action input {
        vertical-align: middle;
        margin: 0;
        margin-right: 10px;
        width: 17px;
        height: 17px;
    }

    .container .form-wapper .form-body button {
        width: 100%;
        padding: 10px 1rem;
        background-color: var(--main-color);
        border: unset;
        border-radius: 5px;
        color: #fff;
        font-size: 1rem;
        cursor: pointer;
    }

    .container .form-wapper .form-body button:hover {
        background-color: var(--main-color-hover);
    }

    .container .form-wapper .form-footer p {
        font-size: 12px;
        margin: 0;
    }

    .container .form-wapper .form-footer p .icon i {
        color: var(--main-color);
        vertical-align: middle;
    }
</style>